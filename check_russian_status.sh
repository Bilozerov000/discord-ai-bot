#!/bin/bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Discord Ð±Ð¾Ñ‚Ð° Ð½Ð° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ

echo "ðŸ¤– Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Discord AI Ð±Ð¾Ñ‚Ð° (Ð ÑƒÑÑÐºÐ°Ñ Ð²ÐµÑ€ÑÐ¸Ñ)"
echo "=========================================="

echo ""
echo "ðŸ“Š Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²:"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ollama
if curl -s http://localhost:11434/api/tags > /dev/null 2>&1; then
    echo "âœ… Ollama (LLM): Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 11434"
else
    echo "âŒ Ollama (LLM): ÐÐµ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑ‚"
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° STT
if curl -s http://localhost:5001/health > /dev/null 2>&1; then
    echo "âœ… STT Ð¡ÐµÑ€Ð²ÐµÑ€: Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 5001 (Ð ÑƒÑÑÐºÐ¸Ð¹ ÑÐ·Ñ‹Ðº)"
else
    echo "âŒ STT Ð¡ÐµÑ€Ð²ÐµÑ€: ÐÐµ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑ‚"
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° TTS
if curl -s http://localhost:5000/health > /dev/null 2>&1; then
    echo "âœ… TTS Ð¡ÐµÑ€Ð²ÐµÑ€: Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 5000" 
else
    echo "âŒ TTS Ð¡ÐµÑ€Ð²ÐµÑ€: ÐÐµ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑ‚"
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Discord Ð±Ð¾Ñ‚Ð°
if pgrep -f "node bot.js" > /dev/null; then
    echo "âœ… Discord Ð‘Ð¾Ñ‚: Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ (PID: $(pgrep -f 'node bot.js'))"
else
    echo "âŒ Discord Ð‘Ð¾Ñ‚: ÐÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚"
fi

echo ""
echo "ðŸ‡·ðŸ‡º ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ€ÑƒÑÑÐºÐ¾Ð³Ð¾ ÑÐ·Ñ‹ÐºÐ°:"
echo "â€¢ Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹: Ð“Ð¾Ð»Ð¾Ð²Ð°, Ð“Ð¾Ð»Ð¾Ð²Ð°ÑÑ‚Ð¸Ðº, Ð§Ð°Ñ‚Ð±Ð¾Ñ‚"
echo "â€¢ STT ÑÐ·Ñ‹Ðº: Ð ÑƒÑÑÐºÐ¸Ð¹ (Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾)"
echo "â€¢ Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚Ñ‹: ÐÐ° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ"
echo "â€¢ TTS: Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ SpeechT5"

echo ""
echo "ðŸ’¾ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²:"
echo "ÐŸÐ°Ð¼ÑÑ‚ÑŒ: $(free -h | awk 'NR==2{printf "%.1f/%.1fGB (%.1f%%)", $3/1024, $2/1024, $3*100/$2}')"

if command -v nvidia-smi &> /dev/null; then
    echo "GPU: $(nvidia-smi --query-gpu=memory.used,memory.total --format=csv,noheader,nounits | awk -F', ' '{printf "%.1f/%.1fGB", $1/1024, $2/1024}')"
fi

echo ""
echo "ðŸ“‹ ÐšÐ°Ðº Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ:"
echo "1. ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÐµÑÑŒ Ðº Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð¼Ñƒ ÐºÐ°Ð½Ð°Ð»Ñƒ Ð² Discord"
echo "2. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /join Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚ÑŒ Ð±Ð¾Ñ‚Ð°"  
echo "3. Ð¡ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¾Ð´Ð½Ð¾ Ð¸Ð· Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð½Ñ‹Ñ… ÑÐ»Ð¾Ð²:"
echo "   â€¢ 'Ð“Ð¾Ð»Ð¾Ð²Ð°, ÐºÐ°Ðº Ð´ÐµÐ»Ð°?'"
echo "   â€¢ 'Ð“Ð¾Ð»Ð¾Ð²Ð°ÑÑ‚Ð¸Ðº, Ñ€Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð°Ð½ÐµÐºÐ´Ð¾Ñ‚'"
echo "   â€¢ 'Ð§Ð°Ñ‚Ð±Ð¾Ñ‚, ÐºÐ°ÐºÐ°Ñ Ð¿Ð¾Ð³Ð¾Ð´Ð°?'"
echo "4. Ð‘Ð¾Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ Ð½Ð° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ"

echo ""
echo "ðŸ”§ ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:"
echo "- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð² Ð±Ð¾Ñ‚Ð°: tail -f bot.log"
echo "- Ð¢ÐµÑÑ‚ Ñ€ÑƒÑÑÐºÐ¾Ð³Ð¾ ÑÐ·Ñ‹ÐºÐ°: .venv/bin/python test_russian.py"
echo "- ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð±Ð¾Ñ‚Ð°: pkill -f 'node bot.js'"  
echo "- ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº: node bot.js > bot.log 2>&1 &"
